./configure --prefix=/usr/local/apache2 \
            --enable-mods-shared=most \
            --enable-ssl \
            --enable-so \
            --with-pcre=/usr/bin/pcre2-config

# 5. Компиляция
make -j$(nproc)

# 6. Установка
sudo make install

# 7. Создание пользователя и группы для Apache (если не существует)
sudo groupadd apache 2>/dev/null || true
sudo useradd -g apache -d /usr/local/apache2 -s /bin/false apache 2>/dev/null || true

# 8. Настройка прав доступа
sudo chown -R apache:apache /usr/local/apache2

# 9. Создание systemd сервиса
sudo tee /etc/systemd/system/apache2.service > /dev/null <<EOF
[Unit]
Description=Apache HTTP Server
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/apache2/bin/apachectl start
ExecStop=/usr/local/apache2/bin/apachectl stop
ExecReload=/usr/local/apache2/bin/apachectl graceful
PIDFile=/usr/local/apache2/logs/httpd.pid
User=apache
Group=apache

[Install]
WantedBy=multi-user.target
EOF

# 10. Включение автозапуска
sudo systemctl daemon-reload
sudo systemctl enable apache2

# 11. Запуск Apache
sudo systemctl start apache2

# 12. Проверка статуса
sudo systemctl status apache2
